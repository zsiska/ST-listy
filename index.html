<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CSLAV ‚Äî Statistick√Ω list trestn√≠ch ƒçin≈Ø (ANZ 2026)</title>
<style>
  :root {
    --primary: #2563eb;
    --primary-light: #3b82f6;
    --primary-dark: #1d4ed8;
    --secondary: #10b981;
    --background: #f8fafc;
    --surface: #ffffff;
    --surface-alt: #f1f5f9;
    --border: #e2e8f0;
    --border-focus: #3b82f6;
    --text: #0f172a;
    --text-muted: #64748b;
    --text-light: #94a3b8;
    --danger: #ef4444;
    --warning: #f59e0b;
    --success: #10b981;
    --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
  }

  [data-theme="dark"] {
    --primary: #3b82f6;
    --primary-light: #60a5fa;
    --primary-dark: #2563eb;
    --secondary: #34d399;
    --background: #0f172a;
    --surface: #1e293b;
    --surface-alt: #334155;
    --border: #475569;
    --border-focus: #60a5fa;
    --text: #f8fafc;
    --text-muted: #cbd5e1;
    --text-light: #94a3b8;
    --danger: #f87171;
    --warning: #fbbf24;
    --success: #34d399;
  }

  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    background: var(--background);
    color: var(--text);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    font-size: 14px;
    line-height: 1.5;
  }

  .header {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    box-shadow: var(--shadow);
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .header-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    max-width: 1400px;
    margin: 0 auto;
    padding: 1rem 1.5rem;
  }

  .header-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--primary);
    margin: 0;
  }

  .header-actions {
    display: flex;
    gap: 0.75rem;
    align-items: center;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border: 1px solid var(--border);
    background: var(--surface);
    color: var(--text);
    text-decoration: none;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .btn:hover {
    background: var(--surface-alt);
    border-color: var(--border-focus);
  }

  .btn-primary {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
  }

  .btn-primary:hover {
    background: var(--primary-dark);
  }

  .btn-secondary {
    background: var(--secondary);
    color: white;
    border-color: var(--secondary);
  }

  .btn-ghost {
    background: transparent;
    border: 1px solid transparent;
  }

  .btn-small {
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
  }

  .container {
    max-width: 1400px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 280px 1fr;
    gap: 1.5rem;
    padding: 1.5rem;
  }

  .sidebar {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 0.75rem;
    padding: 1.5rem;
    box-shadow: var(--shadow);
    height: fit-content;
    position: sticky;
    top: calc(80px + 1.5rem);
  }

  .sidebar-section {
    margin-bottom: 2rem;
  }

  .sidebar-section:last-child {
    margin-bottom: 0;
  }

  .sidebar-title {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
    margin: 0 0 0.75rem 0;
  }

  .sidebar-btn {
    display: block;
    width: 100%;
    text-align: left;
    padding: 0.75rem;
    border: none;
    background: transparent;
    color: var(--text);
    border-radius: 0.5rem;
    font-size: 0.875rem;
    cursor: pointer;
    transition: all 0.2s ease;
    margin-bottom: 0.25rem;
  }

  .sidebar-btn:hover {
    background: var(--surface-alt);
  }

  .sidebar-btn.active {
    background: var(--primary);
    color: white;
  }

  .main-content {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 0.75rem;
    padding: 1.5rem;
    box-shadow: var(--shadow);
  }

  .card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.5rem;
  }

  .card-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text);
    margin: 0;
  }

  .badge-group {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .badge {
    display: inline-flex;
    align-items: center;
    padding: 0.25rem 0.75rem;
    background: var(--surface-alt);
    color: var(--text-muted);
    border: 1px solid var(--border);
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 500;
  }

  .badge-primary {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
  }

  .form-grid {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 1rem;
    align-items: end;
  }

  .form-group {
    display: flex;
    flex-direction: column;
  }

  .form-label {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text);
    margin-bottom: 0.5rem;
  }

  .form-label.required::after {
    content: ' *';
    color: var(--danger);
  }

  .form-input,
  .form-select {
    padding: 0.75rem;
    border: 1px solid var(--border);
    background: var(--surface);
    color: var(--text);
    border-radius: 0.5rem;
    font-size: 0.875rem;
    transition: all 0.2s ease;
  }

  .form-input:focus,
  .form-select:focus {
    outline: none;
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px rgb(59 130 246 / 0.1);
  }

  .form-input:disabled,
  .form-select:disabled {
    background: var(--surface-alt);
    color: var(--text-light);
    cursor: not-allowed;
  }

  .table-container {
    border: 1px solid var(--border);
    border-radius: 0.75rem;
    overflow: hidden;
  }

  .table-scroll {
    max-height: 400px;
    overflow: auto;
  }

  .table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.875rem;
  }

  .table th,
  .table td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid var(--border);
  }

  .table th {
    background: var(--surface-alt);
    font-weight: 600;
    color: var(--text);
    position: sticky;
    top: 0;
    z-index: 10;
  }

  .table tr:last-child td {
    border-bottom: none;
  }

  .table tr:hover {
    background: var(--surface-alt);
  }

  .checkbox-group {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    min-width: 200px;
  }

  .checkbox-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .checkbox {
    width: 1rem;
    height: 1rem;
    border: 1px solid var(--border);
    border-radius: 0.25rem;
    cursor: pointer;
  }

  .checkbox:checked {
    background: var(--primary);
    border-color: var(--primary);
  }

  .note {
    padding: 1rem;
    background: var(--surface-alt);
    border: 1px solid var(--border);
    border-radius: 0.5rem;
    font-size: 0.875rem;
    color: var(--text-muted);
    margin-top: 1rem;
  }

  .alert {
    padding: 1rem;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    margin-bottom: 1rem;
  }

  .alert-success {
    background: rgb(34 197 94 / 0.1);
    border: 1px solid rgb(34 197 94 / 0.2);
    color: rgb(21 128 61);
  }

  .alert-error {
    background: rgb(239 68 68 / 0.1);
    border: 1px solid rgb(239 68 68 / 0.2);
    color: rgb(153 27 27);
  }

  .output-section {
    margin-top: 1rem;
  }

  .output-toggle {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
    background: var(--surface-alt);
    border: 1px solid var(--border);
    border-radius: 0.5rem;
    cursor: pointer;
    font-weight: 500;
  }

  .output-content {
    padding: 1rem;
    background: var(--background);
    border: 1px solid var(--border);
    border-top: none;
    border-radius: 0 0 0.5rem 0.5rem;
    white-space: pre-wrap;
    font-family: 'Consolas', 'Monaco', monospace;
    font-size: 0.75rem;
    max-height: 300px;
    overflow: auto;
  }

  .file-input {
    display: none;
  }

  .stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .stat-card {
    padding: 1rem;
    background: var(--surface-alt);
    border: 1px solid var(--border);
    border-radius: 0.5rem;
    text-align: center;
  }

  .stat-number {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary);
  }

  .stat-label {
    font-size: 0.875rem;
    color: var(--text-muted);
    margin-top: 0.25rem;
  }

  @media (max-width: 1024px) {
    .container {
      grid-template-columns: 1fr;
      padding: 1rem;
    }

    .sidebar {
      position: static;
    }

    .form-grid {
      grid-template-columns: 1fr;
    }

    .header-content {
      padding: 0.75rem 1rem;
    }

    .header-actions {
      flex-direction: column;
      gap: 0.5rem;
    }
  }

  .po-only {
    display: none;
  }
</style>
</head>
<body>
<header class="header">
  <div class="header-content">
    <h1 class="header-title">CSLAV ‚Äî Statistick√Ω list trestn√≠ch ƒçin≈Ø (ANZ 2026)</h1>
    <div class="header-actions">
      <button id="themeBtn" class="btn btn-ghost" title="P≈ôepnout re≈æim">üåô Tmav√Ω re≈æim</button>
      <button id="validateBtn" class="btn">‚úÖ Zkontrolovat</button>
      <button id="exportBtn" class="btn btn-primary">üì• Exportovat JSON</button>
    </div>
  </div>
</header>

<div class="container">
  <aside class="sidebar">
    <div class="sidebar-section">
      <h3 class="sidebar-title">V√Ωbƒõr formul√°≈ôe</h3>
      <button class="sidebar-btn active" data-form="fo">S SL T ‚Äî fyzick√© osoby (FO)</button>
      <button class="sidebar-btn" data-form="po">S SL TPO ‚Äî pr√°vnick√© osoby (PO)</button>
    </div>

    <div class="sidebar-section">
      <h3 class="sidebar-title">Spr√°va ƒç√≠seln√≠k≈Ø</h3>
      <button id="btnLoadCB" class="sidebar-btn">üì• Nahr√°t ƒç√≠seln√≠ky (JSON)</button>
      <input class="file-input" id="cbFile" type="file" accept="application/json" />
      <button id="btnTemplate" class="sidebar-btn">üìÑ St√°hnout ≈°ablonu</button>
      <button id="btnExportCB" class="sidebar-btn">üíæ Exportovat ƒç√≠seln√≠ky</button>
      <div class="note">
        Naƒçten√© ƒç√≠seln√≠ky se ulo≈æ√≠ do <code>localStorage</code> a pou≈æij√≠ po naƒçten√≠ str√°nky.
      </div>
    </div>

    <div class="sidebar-section">
      <h3 class="sidebar-title">Rychl√© akce</h3>
      <button id="addIndication" class="sidebar-btn">+ P≈ôidat indikaci</button>
      <button id="addVictim" class="sidebar-btn">+ P≈ôidat obƒõ≈•</button>
    </div>
  </aside>

  <main class="main-content">
    <section class="card">
      <div class="card-header">
        <h2 class="card-title">Z√°kladn√≠ √∫daje</h2>
        <div class="badge-group">
          <span class="badge badge-primary" id="formLabel">FO</span>
          <span class="badge">Platnost od: 1. 1. 2026</span>
          <span class="badge" id="cbInfo">ƒå√≠seln√≠ky: v√Ωchoz√≠</span>
        </div>
      </div>

      <div class="form-grid">
        <div style="grid-column: span 3;">
          <div class="form-group">
            <label for="form_5a" class="form-label required">5a ‚Äî Skupinov√° vƒõc</label>
            <select id="form_5a" class="form-select">
              <option value="">‚Äî vyberte ‚Äî</option>
              <option value="1">1 ‚Äî Ano</option>
              <option value="2">2 ‚Äî Ne</option>
            </select>
          </div>
        </div>

        <div style="grid-column: span 3;">
          <div class="form-group">
            <label for="form_5b" class="form-label">5b ‚Äî Hlavn√≠ statistick√Ω list</label>
            <select id="form_5b" class="form-select">
              <option value="">‚Äî vyberte ‚Äî</option>
              <option value="1">1 ‚Äî Ano (hlavn√≠ SL)</option>
              <option value="2">2 ‚Äî Ne</option>
            </select>
          </div>
        </div>

        <div style="grid-column: span 3;">
          <div class="form-group">
            <label for="narok53" class="form-label">53 ‚Äî V√Ω≈°e p≈ôiznan√©ho n√°roku (Kƒç)</label>
            <input id="narok53" type="number" min="0" step="1" placeholder="0" class="form-input" />
          </div>
        </div>

        <div class="po-only" style="grid-column: span 3;">
          <div class="form-group">
            <label for="po_25a" class="form-label required">25a ‚Äî ≈ò√≠zen√≠ s fyzickou osobou</label>
            <select id="po_25a" class="form-select">
              <option value="">‚Äî vyberte ‚Äî</option>
              <option value="1">1 ‚Äî Ano</option>
              <option value="2">2 ‚Äî Ne</option>
            </select>
          </div>
        </div>
      </div>

      <div class="note">
        <strong>Pozn√°mka:</strong> Polo≈æka 53 mus√≠ b√Ωt vyplnƒõna, pokud je v indikac√≠ch alespo≈à jeden ≈ô√°dek s 
        <code>IN ‚àà {1,4,6,7,12,13}</code> a ‚ÄûN√°rok po≈°kozen√©ho p≈ôizn√°n" = <code>1</code>, 
        a to jen v hlavn√≠m SL (skup.) nebo mimo skupinu.
      </div>
    </section>

    <section class="card">
      <div class="card-header">
        <h2 class="card-title">Tabulka indikac√≠ (50 / 44)</h2>
        <button class="btn btn-secondary" id="btnAddIndication">+ P≈ôidat indikaci</button>
      </div>

      <div class="stats">
        <div class="stat-card">
          <div class="stat-number" id="indicationsCount">0</div>
          <div class="stat-label">Celkem indikac√≠</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="victimsLinked">0</div>
          <div class="stat-label">Napojen√Ωch obƒõt√≠</div>
        </div>
      </div>

      <div class="table-container">
        <div class="table-scroll">
          <table class="table" id="indicationsTbl">
            <thead>
              <tr>
                <th style="width: 60px;">#</th>
                <th style="width: 150px;">Paragraf TZ</th>
                <th style="width: 120px;">IN (zp≈Øsob PM)</th>
                <th style="width: 140px;">N√°rok po≈°kozen√©ho</th>
                <th style="width: 100px;">Obƒõ≈• ƒç√≠slo</th>
                <th style="width: 80px;">Poƒçet obƒõt√≠</th>
                <th style="min-width: 250px;">Mapovat obƒõti</th>
                <th style="width: 60px;"></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="note">
        <strong>Pozn√°mka:</strong> ‚ÄûObƒõ≈• ƒç√≠slo" a ‚ÄûPoƒçet obƒõt√≠" se p≈ôepoƒç√≠t√° automaticky z vazeb indikace‚Üîobƒõ≈•.
      </div>
    </section>

    <section class="card">
      <div class="card-header">
        <h2 class="card-title">Tabulka obƒõt√≠ trestn√Ωch ƒçin≈Ø (54 / 48)</h2>
        <button class="btn btn-secondary" id="btnAddVictim">+ P≈ôidat obƒõ≈•</button>
      </div>

      <div class="stats">
        <div class="stat-card">
          <div class="stat-number" id="victimsCount">0</div>
          <div class="stat-label">Celkem obƒõt√≠</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="domesticViolence">0</div>
          <div class="stat-label">Dom√°c√≠ n√°sil√≠</div>
        </div>
      </div>

      <div class="table-container">
        <div class="table-scroll">
          <table class="table" id="victimsTbl">
            <thead>
              <tr>
                <th style="width: 60px;">#</th>
                <th style="width: 120px;">Obƒõt√≠ je*</th>
                <th style="width: 120px;">St√°tn√≠ p≈ô√≠slu≈°nost*</th>
                <th style="width: 120px;">Zemƒõ narozen√≠*</th>
                <th style="width: 100px;">Dom√°c√≠ n√°sil√≠*</th>
                <th style="width: 100px;">Druh DN (1)</th>
                <th style="width: 100px;">Druh DN (2)</th>
                <th style="width: 140px;">Pachatelem je (1)</th>
                <th style="width: 140px;">(2)</th>
                <th style="width: 140px;">(3)</th>
                <th style="width: 140px;">(4)</th>
                <th style="width: 140px;">(5)</th>
                <th style="width: 80px;">Femicida</th>
                <th style="width: 120px;">Nen√°v. pohnutka</th>
                <th style="width: 120px;">Intoxikace</th>
                <th style="width: 60px;"></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="note">
        <strong>Tip:</strong> Nejprve p≈ôidejte obƒõ≈•, pak ji v indikac√≠ch propoj√≠te za≈°krt√°v√°tky.
      </div>
    </section>

    <section class="card">
      <div class="card-header">
        <h2 class="card-title">V√Ωstupy a kontrola</h2>
      </div>

      <div class="output-section">
        <div class="output-toggle" onclick="toggleOutput('errors')">
          <span>Chyby kontrol</span>
          <span>‚ñº</span>
        </div>
        <div id="errorsContent" class="output-content" style="display: block;"></div>
      </div>

      <div class="output-section">
        <div class="output-toggle" onclick="toggleOutput('json')">
          <span>JSON ‚Äî 4 struktury (SL, Tabulka indikac√≠, Tabulka obƒõt√≠, Vazebn√≠ tabulka)</span>
          <span>‚ñº</span>
        </div>
        <div id="jsonContent" class="output-content" style="display: none;"></div>
      </div>
    </section>
  </main>
</div>

<script>
(function(){
  // === ƒå√çSELN√çKY ============================================================
  const DEFAULT_CB = {
    meta: { name:'default', version:'0.1', source:'embedded' },
    obetiJe: [
      {id:'11', label:'11 ‚Äî ≈æena'},
      {id:'28', label:'28 ‚Äî mu≈æ'},
      {id:'40', label:'40 ‚Äî d√≠tƒõ ≈æena'},
      {id:'41', label:'41 ‚Äî d√≠tƒõ mu≈æ'},
      {id:'42', label:'42 ‚Äî senior ≈æena'},
      {id:'43', label:'43 ‚Äî senior mu≈æ'},
      {id:'44', label:'44 ‚Äî ≈æena mladistv√°'},
      {id:'45', label:'45 ‚Äî mu≈æ mladistv√Ω'}
    ],
    pachatelemJe: [
      {id:'101', label:'101 ‚Äî souƒçasn√Ω intimn√≠ partner'},
      {id:'102', label:'102 ‚Äî b√Ωval√Ω intimn√≠ partner'},
      {id:'200', label:'200 ‚Äî p≈ô√≠tel/zn√°m√Ω'},
      {id:'210', label:'210 ‚Äî kolega (prac./obchodn√≠ vztah)'},
      {id:'230', label:'230 ‚Äî jin√Ω'},
      {id:'300', label:'300 ‚Äî pachatel obƒõt√≠ nezn√°m√Ω'}
    ],
    druhDN: [
      {id:'1', label:'1 ‚Äî fyzick√©'},
      {id:'2', label:'2 ‚Äî psychick√©'},
      {id:'3', label:'3 ‚Äî ekonomick√©'},
      {id:'4', label:'4 ‚Äî sexu√°ln√≠'},
      {id:'5', label:'5 ‚Äî kontroluj√≠c√≠'},
      {id:'6', label:'6 ‚Äî kybernetick√©'}
    ],
    in: [
      {id:'1', label:'1 ‚Äî odsouzen'},
      {id:'4', label:'4 ‚Äî zastaveno'},
      {id:'6', label:'6 ‚Äî zpro≈°tƒõn'},
      {id:'7', label:'7 ‚Äî schv√°len√© narovn√°n√≠'},
      {id:'12', label:'12 ‚Äî spoleƒçn√Ω trest (¬ß37a/¬ß45)'},
      {id:'13', label:'13 ‚Äî souhrn√Ω trest'}
    ],
    nenavist: [
      {id:'1', label:'1 ‚Äî rasov√°/n√°rodnostn√≠/etnick√°/‚Ä¶'},
      {id:'2', label:'2 ‚Äî sexu√°ln√≠/genderov√° identita, LGBTQIA+'},
      {id:'3', label:'3 ‚Äî politick√° p≈ô√≠slu≈°nost'},
      {id:'4', label:'4 ‚Äî t≈ô√≠dn√≠ p≈ô√≠slu≈°nost'},
      {id:'5', label:'5 ‚Äî n√°bo≈æensk√© vyzn√°n√≠'},
      {id:'9', label:'9 ‚Äî jin√° nen√°vistn√° pohnutka'}
    ],
    intox: [
      {id:'1', label:'1 ‚Äî alkohol'},
      {id:'2', label:'2 ‚Äî omamn√© ƒçi psychotropn√≠ l√°tky'},
      {id:'3', label:'3 ‚Äî l√©ky ƒçi jin√° l√°tka'}
    ],
    staty: [
      {id:'203', label:'203 ‚Äî ƒåesk√° republika'},
      {id:'276', label:'276 ‚Äî Nƒõmecko'},
      {id:'840', label:'840 ‚Äî USA'}
    ],
    paragrafyTax: [
      '¬ß 140','¬ß 141/2(c)','¬ß 142','¬ß 145/2(c)','¬ß 145/3','¬ß 146/2(b)','¬ß 146a/4(c)','¬ß 149/3(b)','¬ß 164/3(a)','¬ß 164/4(a)','¬ß 166/3(c)','¬ß 166/4(c)','¬ß 168/1','¬ß 232a/1','¬ß 198','¬ß 199','¬ß 220','¬ß 219/2(e)','¬ß 377/2'
    ]
  };

  function loadCBFromStorage(){
    try { 
      const raw = localStorage.getItem('cslav_cb_v1'); 
      if(!raw) return null; 
      return JSON.parse(raw);
    } catch(e){ 
      return null; 
    }
  }
  
  function saveCBToStorage(cb){ 
    localStorage.setItem('cslav_cb_v1', JSON.stringify(cb)); 
  }

  let CB = loadCBFromStorage() || DEFAULT_CB;

  // === APLIKAƒåN√ç STAV =======================================================
  const state = {
    form:'fo', 
    fiveA:'', 
    fiveB:'', 
    narok53:'', 
    po25a:'',
    indications: [], // {id, paragraf, in, narok, victims:Set(ids)}
    victims: []      // {id, obetiJe, stat, zeme, dn, dn1, dn2, pj:[...5], femicida, nenavist, intox}
  };

  // === POMOCN√â FUNKCE =======================================================
  const el = id => document.getElementById(id);
  const qsa = (sel,root=document) => Array.from(root.querySelectorAll(sel));
  const opt = (id,label,val) => `<option value="${id}" ${id==val?'selected':''}>${label}</option>`;
  const opts = (arr,val) => arr.map(x=>opt(x.id,x.label,val)).join('');

  function applyTheme(t){ 
    document.documentElement.setAttribute('data-theme', t==='light'?'light':'dark'); 
    localStorage.setItem('theme',t); 
    el('themeBtn').onclick = ()=> applyTheme((localStorage.getItem('theme')||'light')==='light'?'dark':'light');

  function cbInfoText(){ 
    const m=CB.meta||{}; 
    return `ƒå√≠seln√≠ky: ${m.name||'n/a'} v${m.version||'n/a'}`; 
  }

  function toggleOutput(type) {
    const content = el(type + 'Content');
    const toggle = content.previousElementSibling.querySelector('span:last-child');
    if (content.style.display === 'none') {
      content.style.display = 'block';
      toggle.textContent = '‚ñ≤';
    } else {
      content.style.display = 'none';
      toggle.textContent = '‚ñº';
    }
  }

  // === UI HANDLERY ==========================================================
  qsa('.sidebar-btn[data-form]').forEach(btn=>{
    btn.onclick = ()=>{ 
      qsa('.sidebar-btn[data-form]').forEach(b=>b.classList.remove('active')); 
      btn.classList.add('active'); 
      state.form=btn.dataset.form; 
      el('formLabel').textContent= state.form==='fo'?'FO':'PO'; 
      qsa('.po-only').forEach(x=>x.style.display = state.form==='po'?'block':'none'); 
      render(); 
    };
  });

  el('form_5a').onchange = e=>{ state.fiveA = e.target.value; render(); };
  el('form_5b').onchange = e=>{ state.fiveB = e.target.value; render(); };
  el('narok53').oninput = e=> state.narok53 = e.target.value;
  el('po_25a').onchange = e=> state.po25a = e.target.value;

  // Add rows
  function addIndication(){ 
    const id = state.indications.length? Math.max(...state.indications.map(r=>r.id))+1 : 1; 
    state.indications.push({id,paragraf:'',in:'',narok:'',victims:new Set()}); 
    render(); 
  }
  
  function addVictim(){ 
    const id = state.victims.length? Math.max(...state.victims.map(r=>r.id))+1 : 1; 
    state.victims.push({id,obetiJe:'',stat:CB.staty?.[0]?.id||'',zeme:CB.staty?.[0]?.id||'',dn:'',dn1:'',dn2:'',pj:['','','','',''],femicida:'',nenavist:'',intox:''}); 
    render(); 
  }
  
  el('btnAddIndication').onclick = addIndication; 
  el('addIndication').onclick = addIndication;
  el('btnAddVictim').onclick = addVictim; 
  el('addVictim').onclick = addVictim;

  // ƒå√≠seln√≠ky ‚Äî nahr√°n√≠/export
  el('btnLoadCB').onclick = ()=> el('cbFile').click();
  el('cbFile').onchange = async (e)=>{
    const f = e.target.files?.[0]; 
    if(!f) return; 
    try{
      const txt = await f.text(); 
      const json = JSON.parse(txt);
      // Jednoduch√° validace struktur
      const needed = ['obetiJe','pachatelemJe','druhDN','in','nenavist','intox','staty','paragrafyTax'];
      const miss = needed.filter(k=>!(k in json));
      if(miss.length){ 
        alert('V JSON chyb√≠ tyto sekce ƒç√≠seln√≠k≈Ø: '+miss.join(', ')); 
        return; 
      }
      CB = json; 
      saveCBToStorage(CB); 
      render(); 
      alert('ƒå√≠seln√≠ky nahr√°ny.');
    }catch(err){ 
      alert('Nepoda≈ôilo se naƒç√≠st JSON: '+err); 
    }
    e.target.value = '';
  };
  
  el('btnTemplate').onclick = ()=>{
    const tpl = {
      meta:{ name:'produkƒçn√≠-ƒç√≠seln√≠ky', version:'2026.01', source:'ISAS/CSLAV export' },
      obetiJe:[ {id:'11',label:'11 ‚Äî ≈æena'}, {id:'28',label:'28 ‚Äî mu≈æ'} ],
      pachatelemJe:[ {id:'101',label:'101 ‚Äî souƒçasn√Ω intimn√≠ partner'} ],
      druhDN:[ {id:'1',label:'1 ‚Äî fyzick√©'} ],
      in:[ {id:'1',label:'1 ‚Äî odsouzen'} ],
      nenavist:[ {id:'2',label:'2 ‚Äî sexu√°ln√≠/genderov√° identita'} ],
      intox:[ {id:'1',label:'1 ‚Äî alkohol'} ],
      staty:[ {id:'203',label:'203 ‚Äî ƒåesk√° republika'} ],
      paragrafyTax:[ '¬ß 140','¬ß 198' ]
    };
    const blob = new Blob([JSON.stringify(tpl,null,2)],{type:'application/json'});
    const a=document.createElement('a'); 
    a.href=URL.createObjectURL(blob); 
    a.download='cslav_ciselniky_sablona.json'; 
    a.click();
  };
  
  el('btnExportCB').onclick = ()=>{
    const blob = new Blob([JSON.stringify(CB,null,2)],{type:'application/json'});
    const a=document.createElement('a'); 
    a.href=URL.createObjectURL(blob); 
    a.download=`cslav_ciselniky_${(CB.meta?.name||'curr')}.json`; 
    a.click();
  };

  // === Vykreslen√≠ tabulek ===================================================
  function updateStats() {
    el('indicationsCount').textContent = state.indications.length;
    el('victimsCount').textContent = state.victims.length;
    
    const linkedVictims = new Set();
    state.indications.forEach(ind => {
      ind.victims.forEach(vid => linkedVictims.add(vid));
    });
    el('victimsLinked').textContent = linkedVictims.size;
    
    const domesticCount = state.victims.filter(v => v.dn === '1').length;
    el('domesticViolence').textContent = domesticCount;
  }

  function render(){
    el('cbInfo').textContent = cbInfoText();
    updateStats();

    // Indikace
    const tb = document.querySelector('#indicationsTbl tbody'); 
    tb.innerHTML='';
    state.indications.forEach(row=>{
      const mapCell = `<div class="checkbox-group">${state.victims.map(v=>{
        const chk = row.victims.has(v.id)?'checked':'';
        return `<div class="checkbox-item">
          <input type='checkbox' class="checkbox" data-bind='map' data-ind='${row.id}' data-victim='${v.id}' ${chk}/>
          <span>Obƒõ≈• ${v.id}</span>
        </div>`; 
      }).join('')}</div>`;
      
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${row.id}</td>
        <td>
          <select class="form-select" data-bind='paragraf' data-id='${row.id}'>
            <option value=''>‚Äî vyberte ‚Äî</option>
            ${CB.paragrafyTax.map(p=>`<option value='${p}' ${row.paragraf===p?'selected':''}>${p}</option>`).join('')}
          </select>
        </td>
        <td>
          <select class="form-select" data-bind='in' data-id='${row.id}'>
            <option value=''>‚Äî</option>
            ${opts(CB.in, row.in)}
          </select>
        </td>
        <td>
          <select class="form-select" data-bind='narok' data-id='${row.id}'>
            <option value=''>‚Äî</option>
            <option value='1' ${row.narok==='1'?'selected':''}>1 ‚Äî vyhovƒõno</option>
            <option value='2' ${row.narok==='2'?'selected':''}>2 ‚Äî nep≈ôizn√°n</option>
            <option value='3' ${row.narok==='3'?'selected':''}>3 ‚Äî neuplatnƒõn</option>
          </select>
        </td>
        <td>${Array.from(row.victims).sort((a,b)=>a-b).join(',')}</td>
        <td>${Array.from(row.victims).length}</td>
        <td>${mapCell}</td>
        <td><button class='btn btn-small' data-bind='delInd' data-id='${row.id}' title='Smazat'>üóëÔ∏è</button></td>`;
      tb.appendChild(tr);
    });

    // Obƒõti
    const tv = document.querySelector('#victimsTbl tbody'); 
    tv.innerHTML='';
    const isGroup = state.fiveA==='1'; 
    const isMain = state.fiveB==='1';
    const victimsDisabled = (isGroup && !isMain);

    state.victims.forEach(v=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${v.id}</td>
        <td><select class="form-select" data-bind='v_obetiJe' data-id='${v.id}' ${victimsDisabled?'disabled':''}><option value=''>‚Äî</option>${opts(CB.obetiJe, v.obetiJe)}</select></td>
        <td><select class="form-select" data-bind='v_stat' data-id='${v.id}' ${victimsDisabled?'disabled':''}>${opts(CB.staty, v.stat)}</select></td>
        <td><select class="form-select" data-bind='v_zeme' data-id='${v.id}' ${victimsDisabled?'disabled':''}>${opts(CB.staty, v.zeme)}</select></td>
        <td><select class="form-select" data-bind='v_dn' data-id='${v.id}' ${victimsDisabled?'disabled':''}><option value=''>‚Äî</option><option value='1' ${v.dn==='1'?'selected':''}>1 ‚Äî Ano</option><option value='2' ${v.dn==='2'?'selected':''}>2 ‚Äî Ne</option></select></td>
        <td><select class="form-select" data-bind='v_dn1' data-id='${v.id}' ${victimsDisabled?'disabled':''}><option value=''>‚Äî</option>${opts(CB.druhDN, v.dn1)}</select></td>
        <td><select class="form-select" data-bind='v_dn2' data-id='${v.id}' ${victimsDisabled?'disabled':''}><option value=''>‚Äî</option>${opts(CB.druhDN, v.dn2)}</select></td>
        <td><select class="form-select" data-bind='v_pj' data-idx='0' data-id='${v.id}' ${victimsDisabled?'disabled':''}><option value=''>‚Äî</option>${opts(CB.pachatelemJe, v.pj[0])}</select></td>
        <td><select class="form-select" data-bind='v_pj' data-idx='1' data-id='${v.id}' ${victimsDisabled?'disabled':''}><option value=''>‚Äî</option>${opts(CB.pachatelemJe, v.pj[1])}</select></td>
        <td><select class="form-select" data-bind='v_pj' data-idx='2' data-id='${v.id}' ${victimsDisabled?'disabled':''}><option value=''>‚Äî</option>${opts(CB.pachatelemJe, v.pj[2])}</select></td>
        <td><select class="form-select" data-bind='v_pj' data-idx='3' data-id='${v.id}' ${victimsDisabled?'disabled':''}><option value=''>‚Äî</option>${opts(CB.pachatelemJe, v.pj[3])}</select></td>
        <td><select class="form-select" data-bind='v_pj' data-idx='4' data-id='${v.id}' ${victimsDisabled?'disabled':''}><option value=''>‚Äî</option>${opts(CB.pachatelemJe, v.pj[4])}</select></td>
        <td><select class="form-select" data-bind='v_fem' data-id='${v.id}' ${victimsDisabled?'disabled':''}><option value=''>‚Äî</option><option value='1' ${v.femicida==='1'?'selected':''}>1 ‚Äî ano</option><option value='2' ${v.femicida==='2'?'selected':''}>2 ‚Äî ne</option></select></td>
        <td><select class="form-select" data-bind='v_nen' data-id='${v.id}' ${victimsDisabled?'disabled':''}><option value=''>‚Äî</option>${opts(CB.nenavist, v.nenavist)}</select></td>
        <td><select class="form-select" data-bind='v_intox' data-id='${v.id}' ${victimsDisabled?'disabled':''}><option value=''>‚Äî</option>${opts(CB.intox, v.intox)}</select></td>
        <td><button class='btn btn-small' data-bind='delVictim' data-id='${v.id}' title='Smazat'>üóëÔ∏è</button></td>`;
      tv.appendChild(tr);
    });

    // Bind events
    qsa('[data-bind]').forEach(ctrl=>{ 
      ctrl.onchange = ()=>{
        const b = ctrl.getAttribute('data-bind');
        if(b==='paragraf'){ 
          const id=+ctrl.getAttribute('data-id'); 
          const r=state.indications.find(x=>x.id===id); 
          r.paragraf=ctrl.value; 
        }
        else if(b==='in'){ 
          const id=+ctrl.getAttribute('data-id'); 
          const r=state.indications.find(x=>x.id===id); 
          r.in=ctrl.value; 
        }
        else if(b==='narok'){ 
          const id=+ctrl.getAttribute('data-id'); 
          const r=state.indications.find(x=>x.id===id); 
          r.narok=ctrl.value; 
        }
        else if(b==='map'){ 
          const ind=+ctrl.getAttribute('data-ind'); 
          const vid=+ctrl.getAttribute('data-victim'); 
          const r=state.indications.find(x=>x.id===ind); 
          if(ctrl.checked) r.victims.add(vid); 
          else r.victims.delete(vid); 
          render(); 
        }
        else if(b==='delInd'){ 
          const id=+ctrl.getAttribute('data-id'); 
          state.indications = state.indications.filter(x=>x.id!==id); 
          render(); 
        }
        else if(b==='delVictim'){ 
          const id=+ctrl.getAttribute('data-id'); 
          state.victims = state.victims.filter(x=>x.id!==id); 
          state.indications.forEach(r=>r.victims.delete(id)); 
          render(); 
        }
        else if(b.startsWith('v_')){
          const id=+ctrl.getAttribute('data-id'); 
          const v=state.victims.find(x=>x.id===id);
          if(b==='v_obetiJe') v.obetiJe=ctrl.value;
          if(b==='v_stat') v.stat=ctrl.value;
          if(b==='v_zeme') v.zeme=ctrl.value;
          if(b==='v_dn') v.dn=ctrl.value;
          if(b==='v_dn1') v.dn1=ctrl.value;
          if(b==='v_dn2') v.dn2=ctrl.value;
          if(b==='v_fem') v.femicida=ctrl.value;
          if(b==='v_nen') v.nenavist=ctrl.value;
          if(b==='v_intox') v.intox=ctrl.value;
        }
        if(b==='v_pj'){ 
          const id=+ctrl.getAttribute('data-id'); 
          const v=state.victims.find(x=>x.id===id); 
          const idx=+ctrl.getAttribute('data-idx'); 
          v.pj[idx]=ctrl.value; 
        }
        updateStats();
      }; 
    });
  }

  // === Validace =============================================================
  function validate(){
    const errs = [];
    const isGroup = state.fiveA==='1'; 
    const isMain = state.fiveB==='1';

    // 5a povinnƒõ
    if(!state.fiveA) errs.push('Polo≈æka 5a (Skupinov√° vƒõc) je povinn√°.');
    if(state.fiveA==='1' && !state.fiveB) errs.push('Je-li 5a=1 (skupinov√° vƒõc), pak 5b (Hlavn√≠ SL) mus√≠ b√Ωt vyplnƒõno.');
    if(state.fiveA==='2' && state.fiveB) errs.push('Je-li 5a=2 (neskup.), pak 5b nesm√≠ b√Ωt vyplnƒõno.');

    // ƒå√≠seln√≠kov√© kontroly
    const inSet = new Set(CB.in.map(x=>x.id));
    const obetiSet = new Set(CB.obetiJe.map(x=>x.id));
    const statSet = new Set(CB.staty.map(x=>x.id));
    const dnSet = new Set(CB.druhDN.map(x=>x.id));
    const pjSet = new Set(CB.pachatelemJe.map(x=>x.id));
    const nenSet = new Set(CB.nenavist.map(x=>x.id));
    const intSet = new Set(CB.intox.map(x=>x.id));
    const taxSet = new Set(CB.paragrafyTax);

    state.indications.forEach(r=>{
      if(r.in && !inSet.has(r.in)) errs.push(`Indikace ${r.id}: hodnota IN="${r.in}" nen√≠ v ƒç√≠seln√≠ku.`);
      if(r.paragraf && !taxSet.has(r.paragraf)) errs.push(`Indikace ${r.id}: paragraf "${r.paragraf}" nen√≠ v naƒçten√©m seznamu taxativn√≠ch paragraf≈Ø.`);
    });

    if(isGroup && !isMain && state.victims.length>0) errs.push('U skupinov√© vƒõci lze Tabulku obƒõt√≠ vyplnit pouze v hlavn√≠m SL (5b=1).');

    state.victims.forEach(v=>{
      if(!v.obetiJe) errs.push(`Obƒõ≈• ${v.id}: ‚ÄûObƒõt√≠ je" je povinn√©.`);
      if(!v.stat) errs.push(`Obƒõ≈• ${v.id}: ‚ÄûSt√°tn√≠ p≈ô√≠slu≈°nost obƒõti" je povinn√°.`);
      if(!v.zeme) errs.push(`Obƒõ≈• ${v.id}: ‚ÄûZemƒõ narozen√≠ obƒõti" je povinn√°.`);
      if(!v.dn) errs.push(`Obƒõ≈• ${v.id}: ‚ÄûDom√°c√≠ n√°sil√≠" je povinn√©.`);

      if(v.obetiJe && !obetiSet.has(v.obetiJe)) errs.push(`Obƒõ≈• ${v.id}: k√≥d ‚ÄûObƒõt√≠ je = ${v.obetiJe}" nen√≠ v ƒç√≠seln√≠ku.`);
      if(v.stat && !statSet.has(v.stat)) errs.push(`Obƒõ≈• ${v.id}: k√≥d st√°tn√≠ p≈ô√≠slu≈°nosti ‚Äû${v.stat}" nen√≠ v ƒç√≠seln√≠ku.`);
      if(v.zeme && !statSet.has(v.zeme)) errs.push(`Obƒõ≈• ${v.id}: k√≥d zemƒõ narozen√≠ ‚Äû${v.zeme}" nen√≠ v ƒç√≠seln√≠ku.`);
      if(v.dn1 && !dnSet.has(v.dn1)) errs.push(`Obƒõ≈• ${v.id}: ‚ÄûDruh DN (1) = ${v.dn1}" nen√≠ v ƒç√≠seln√≠ku.`);
      if(v.dn2 && !dnSet.has(v.dn2)) errs.push(`Obƒõ≈• ${v.id}: ‚ÄûDruh DN (2) = ${v.dn2}" nen√≠ v ƒç√≠seln√≠ku.`);
      v.pj.forEach((p,ix)=>{ 
        if(p && !pjSet.has(p)) errs.push(`Obƒõ≈• ${v.id}: ‚ÄûPachatelem je (${ix+1}) = ${p}" nen√≠ v ƒç√≠seln√≠ku.`);
      });
      if(v.nenavist && !nenSet.has(v.nenavist)) errs.push(`Obƒõ≈• ${v.id}: ‚ÄûNen√°vistn√° pohnutka = ${v.nenavist}" nen√≠ v ƒç√≠seln√≠ku.`);
      if(v.intox && !intSet.has(v.intox)) errs.push(`Obƒõ≈• ${v.id}: ‚ÄûIntoxikace = ${v.intox}" nen√≠ v ƒç√≠seln√≠ku.`);

      if(v.dn==='1'){
        if(!v.dn1 && !v.dn2) errs.push(`Obƒõ≈• ${v.id}: p≈ôi DN=1 zadejte alespo≈à jeden ‚ÄûDruh DN"`);
        const pjCount = v.pj.filter(Boolean).length; 
        if(pjCount===0) errs.push(`Obƒõ≈• ${v.id}: p≈ôi DN=1 je povinn√© zadat ‚ÄûPachatelem je" (1‚Äî5 k√≥d≈Ø)`);
      }
      if(v.dn==='2'){
        if(v.dn1||v.dn2||v.pj.some(Boolean)) errs.push(`Obƒõ≈• ${v.id}: p≈ôi DN=2 nesm√≠ b√Ωt vyplnƒõn ‚ÄûDruh DN" ani ‚ÄûPachatelem je".`);
      }

      // Nepovolen√© kombinace
      if((v.obetiJe==='40'||v.obetiJe==='41')){
        if(v.pj.includes('200')||v.pj.includes('210')) errs.push(`Obƒõ≈• ${v.id}: pro d√≠tƒõ (40/41) nesm√≠ b√Ωt ‚Äûpachatelem je" 200/210.`);
      }
      const onlyIntimate = v.pj.filter(x=>x==='101'||x==='102').length>0 && v.pj.filter(Boolean).length===1;
      if(onlyIntimate && (v.obetiJe==='40'||v.obetiJe==='41')) errs.push(`Obƒõ≈• ${v.id}: pokud jedin√Ωm pachatelem je 101/102, obƒõt√≠ nesm√≠ b√Ωt d√≠tƒõ (40/41), a naopak.`);
    });

    // Femicida pravidlo
    const femTrigger = state.indications.some(r=> r.paragraf.startsWith('¬ß 140') || r.paragraf.startsWith('¬ß 145/3'));
    if(femTrigger){
      state.victims.forEach(v=>{
        if(['11','40','42','44'].includes(v.obetiJe)){
          if(v.femicida!=='1') errs.push(`Obƒõ≈• ${v.id}: p≈ôi ¬ß140 nebo ¬ß145/3 a ≈æensk√© obƒõti mus√≠ b√Ωt Femicida=1.`);
          if(v.femicida==='1' && v.nenavist!=='2') errs.push(`Obƒõ≈• ${v.id}: pokud Femicida=1, mus√≠ b√Ωt ‚ÄûNen√°vistn√° pohnutka" = 2.`);
        }
      });
    }

    // Povinnost obƒõt√≠ pro taxativn√≠ paragrafy
    state.indications.filter(r=>CB.paragrafyTax.includes(r.paragraf)).forEach(r=>{
      if(r.victims.size===0) errs.push(`Indikace ${r.id}: pro paragraf ${r.paragraf} mus√≠ b√Ωt nav√°z√°na alespo≈à 1 obƒõ≈•.`);
    });

    // N√°rok 53
    const anyReqNarok = state.indications.some(r=> ['1','4','6','7','12','13'].includes(r.in) && r.narok==='1');
    if(anyReqNarok){ 
      const okScope = (!isGroup) || (isGroup && isMain); 
      if(!okScope) errs.push('Polo≈æka 53 (V√Ω≈°e p≈ôiznan√©ho n√°roku) je povolena jen v hlavn√≠m SL ve skupinov√© vƒõci.'); 
      if(!state.narok53 || +state.narok53<=0) errs.push('Je-li ‚ÄûN√°rok po≈°kozen√©ho p≈ôizn√°n"=1 (a IN‚àà{1,4,6,7,12,13}), mus√≠ b√Ωt polo≈æka 53 vyplnƒõna (>0).'); 
    }

    const errorsEl = el('errorsContent');
    if(errs.length === 0) {
      errorsEl.innerHTML = '<div class="alert alert-success">‚úÖ ≈Ω√°dn√© chyby nalezeny.</div>';
    } else {
      errorsEl.innerHTML = '<div class="alert alert-error">‚Ä¢ ' + errs.join('\n‚Ä¢ ') + '</div>';
    }
    
    return errs;
  }

  // === Export JSON ==========================================================
  function exportJSON(){
    const SL = { 
      typ: state.form==='fo'?'S SL T (FO)':'S SL TPO (PO)', 
      p5a: state.fiveA||null, 
      p5b: state.fiveB||null, 
      narok53: state.narok53?Number(state.narok53):null, 
      po25a: state.form==='po'?(state.po25a||null):null, 
      codebooks: (CB.meta||{}).name||'n/a', 
      codebooksVersion: (CB.meta||{}).version||'n/a' 
    };
    
    const VICT = state.victims.map(v=>({ 
      id:v.id, 
      obeti_je:v.obetiJe||null, 
      stat_prisl:v.stat||null, 
      zeme_nar:v.zeme||null, 
      domaci_nasili:v.dn||null, 
      druh_dn1:v.dn1||null, 
      druh_dn2:v.dn2||null, 
      pachatelem_je:v.pj.filter(Boolean), 
      femicida:v.femicida||null, 
      nenavistna_pohnutka:v.nenavist||null, 
      intoxikace:v.intox||null 
    }));
    
    const IND = state.indications.map(r=>({ 
      id:r.id, 
      paragraf:r.paragraf||null, 
      in:r.in||null, 
      narok:r.narok||null, 
      obet_cislo:Array.from(r.victims).sort((a,b)=>a-b).join(','), 
      pocet_obeti:Array.from(r.victims).length 
    }));
    
    const REL = []; 
    state.indications.forEach(r=> 
      Array.from(r.victims).forEach(vid=> 
        REL.push({ind_id:r.id, obet_id:vid})
      ) 
    );
    
    const out = { SL, IND, VICT, REL };
    el('jsonContent').textContent = JSON.stringify(out,null,2);
    
    const blob = new Blob([JSON.stringify(out,null,2)],{type:'application/json'}); 
    const a=document.createElement('a'); 
    a.href=URL.createObjectURL(blob); 
    a.download='cslav_prototyp_export.json'; 
    a.click();
  }

  el('validateBtn').onclick = validate;
  el('exportBtn').onclick = exportJSON;

  // Initialize
  addIndication(); 
  addVictim();
  el('cbInfo').textContent = cbInfoText();
  render();
  validate();

  // Make functions global for onclick handlers
  window.toggleOutput = toggleOutput;
})();
</script>
</body>
</html>textContent = t==='light'?'‚òÄÔ∏è Svƒõtl√Ω re≈æim':'üåô Tmav√Ω re≈æim'; 
  }
  
  applyTheme(localStorage.getItem('theme')||'light');
  el('themeBtn').
